from pyvrp import Model
import matplotlib.pyplot as plt
from pyvrp.stop import MaxRuntime

from pyvrp.plotting import plot_coordinates, plot_solution

# fmt: off
COORDS = [
    (365, 689), (146, 180), (792, 5), (658, 510), (461, 270), (299, 531), (812, 228), (643, 90), (615, 630), (258, 42), (616, 299), (475, 957), (425, 473), (406, 64), (656, 369), (202, 467), (318, 21), (579, 587), (458, 354), (575, 871), (47, 512), (568, 742), (128, 436), (546, 806), (197, 696), (615, 300), (852, 563), (772, 803), (678, 342), (916, 176), (390, 949), (113, 782), (226, 736), (119, 923), (584, 572), (134, 554), (912, 173), (827, 233), (851, 677), (598, 322), (627, 472), (94, 442), (688, 274), (977, 176), (597, 461), (931, 23), (170, 640), (941, 601), (873, 487), (797, 95), (451, 816), (866, 970), (833, 912), (106, 913), (260, 107), (332, 45), (685, 613), (728, 372), (487, 497), (702, 440), (717, 412), (635, 794), (927, 972), (635, 356), (634, 540), (658, 261), (303, 168), (707, 410), (254, 135), (346, 29), (75, 79), (893, 987), (729, 372), (29, 910), (356, 39), (274, 943), (322, 96), (664, 396), (704, 236), (415, 837), (576, 587), (750, 977), (726, 363), (861, 948), (302, 129), (415, 989), (199, 135), (801, 405), (679, 426), (994, 804), (311, 116), (739, 898), (268, 97), (176, 991), (688, 588), (107, 836), (708, 522), (679, 864), (985, 877), (954, 950), (615, 750)
]
DEMANDS = [0, 38, 51, 73, 70, 58, 54, 1, 98, 62, 98, 25, 86, 46, 27, 17, 97, 74, 81, 62, 59, 23, 62, 66, 35, 53, 18, 87, 32, 4, 61, 95, 23, 15, 5, 53, 97, 70, 32, 27, 42, 67, 76, 15, 39, 14, 43, 11, 93, 53, 44, 80, 87, 97, 67, 72, 50, 8, 58, 55, 67, 89, 38, 65, 3, 5, 46, 100, 52, 28, 96, 18, 16, 7, 73, 76, 6, 64, 39, 86, 70, 14, 83, 96, 43, 12, 73, 2, 21, 18, 55, 75, 68, 100, 61, 24, 40, 48, 51, 78, 35]
# fmt: on

m = Model()
m.add_vehicle_type(1, capacity=400)
m.add_vehicle_type(2, capacity=600)
m.add_vehicle_type(2, capacity=800)
m.add_vehicle_type(2, capacity=1000)

depot = m.add_depot(x=COORDS[0][0], y=COORDS[0][1])
clients = [
    m.add_client(x=COORDS[idx][0], y=COORDS[idx][1], delivery=DEMANDS[idx])
    for idx in range(1, len(COORDS))
]

locations = [depot] + clients
for frm in locations:
    for to in locations:
        distance = abs(frm.x - to.x) + abs(frm.y - to.y)  # Manhattan
        m.add_edge(frm, to, distance=distance)

# _, ax = plt.subplots(figsize=(8, 8))
# plot_coordinates(m.data(), ax=ax)

res = m.solve(stop=MaxRuntime(10), display=True)  # one second
print(res)

_, ax = plt.subplots(figsize=(8, 8))
plot_solution(res.best, m.data(), ax=ax)
plt.show()